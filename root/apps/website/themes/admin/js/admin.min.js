new admin;;function admin(){this.version='1.1.0';this.MENU_WIDTH=null;this.USER=null;this.PAGE=null;var _admin=this;this.onclick=[];this.init=function(){window._admin=this;this.initPopState();this.USER=this.logData();this.loginInit();this.initBody();WINDOW_EVENTS.onresize.push(this.initBody);this.initMenu();this.menuMovableLeft('menu');this.initAnchors();WINDOW_EVENTS.execAll();};this.initBody=function(){var webBody=document.getElementById('website-body');var webContent=document.getElementById('website-content');if(!webBody||!webContent){return false;}var minHeight=window.innerHeight-67;webBody.style.minHeight=minHeight+'px';};this.request=function(method,callback,errorResult,data){var url=WEBSITE_ADDRESS+'?'+ADMIN_KEY+'=ajax/'+method;return _admin.stream(url,callback,errorResult,data);};this.go=function(path){return this.getPageData(path);};this.initPopState=function(){WINDOW_EVENTS.onpopstate.push(function(e){if(!window.history.state){var gets=_admin.parsePageQuery(location.search);return _admin.getPageData(gets[ADMIN_KEY]);}return _admin.putPageData(window.history.state,true);});var gets=_admin.parsePageQuery(location.search);return _admin.getPageData(gets[ADMIN_KEY]);};this.initAnchors=function(){var an=document.querySelectorAll('a[href]');var i=an.length;while(i--){an[i].onclick=this.execAnchor;}return true;};this.execAnchor=function(e){e.preventDefault();_admin.menuHide();if(!window.hasOwnProperty('WEBSITE_ADDRESS')||!this.href){return false;}var query='?website-ajax-request=true';var href=this.getAttribute('href').replace(WEBSITE_ADDRESS,'');if(href.match(/^http/i)||this.target=='_blank'){return window.open(this.href,'_blank');}var webContent=document.getElementById('website-content');if(!webContent){return window.location.assign(href);}if(Array.isArray(_admin.onclick)){for(var i=0;i<_admin.onclick.length;i++){if(typeof _admin.onclick[i]==='function'){_admin.onclick[i]();}}}var gets=_admin.parsePageQuery(href);if(!gets.hasOwnProperty(ADMIN_KEY)||gets[ADMIN_KEY].indexOf('plugin/')===0){return _admin.externalPage(href,this.innerText);}return _admin.getPageData(gets[ADMIN_KEY]);};this.getPageData=function(path){if(path==='logout'){return _admin.logout();}path=typeof path==='string'&&path!=''?path:'dashboard';var query='?'+ADMIN_KEY+'=page/'+path;var url=WEBSITE_ADDRESS+query;_admin.path=path;var webContent=document.getElementById('website-content');if(!webContent){return false;}document.scrollingElement.scroll(0,0);var clone=webContent.innerHTML;webContent.innerText='Loading...';_admin.loader(true);return _admin.getContent(url,function(r){_admin.loader(false);if(typeof r!=='object'){webContent.innerHTML=clone;_admin.initAnchors();var errText=r.match(/^error/i)?r:'Error: Failed to load content.';return _admin.error(errText);}var notSave=location.search===query&&window.history.state?true:false;return _admin.putPageData(r,notSave);},function(r){_admin.loader(false);webContent.innerHTML=clone;_admin.initAnchors();return _admin.error('Error: Failed to load content.');},false);};this.putPageData=function(page,notSave){if(typeof page!=='object'||page===null||!page.hasOwnProperty('url')||!page.hasOwnProperty('title')||!page.hasOwnProperty('content')){return false;}_admin.PAGE=page;_admin.externalPageClose();var webContent=document.getElementById('website-content');if(!webContent){return false;}var data=page.hasOwnProperty('data')&&typeof page.data==='object'&&page.data!==null?page.data:{};var content=_admin.fillPageData(page.content,data);var doc=(new DOMParser).parseFromString(content,'text/html');var scr=doc.querySelectorAll('script'),i=scr.length,tempEl=[];while(i--){var ns=document.createElement('script');ns.async=true;ns.type='text/javascript';if(scr[i].src){ns.src=scr[i].src;}else{ns.textContent=scr[i].textContent;}tempEl.push(ns);scr[i].parentElement.removeChild(scr[i]);}webContent.innerHTML=doc.body.innerHTML;for(var i=tempEl.length;i--;i>=0){webContent.appendChild(tempEl[i]);}var title=document.querySelector('title');if(title){title.innerText=page.title+' - webAdmin';}if(!notSave){var pageSize=JSON.stringify(page).length;if(pageSize<524288){window.history.pushState(page,page.title,page.url);}}return _admin.initAnchors();};this.parsePageQuery=function(str){str=typeof str==='string'?str:'';var hrefs=str.split('?');var query=hrefs.hasOwnProperty(1)?hrefs[1]:'';return _admin.parseStr(query);};this.fillPageData=function(content,data){if(typeof content!=='string'){return content;}data=typeof data==='object'&&data!==null?data:{};return content.replace(/{{[a-z0-9\._]+}}/ig,function(m){var n=m.substr(2,m.length-4),s=n.split('.'),r=false,t=false,u=false;for(var i=0;i<s.length;i++){if(typeof r==='object'&&r.hasOwnProperty(s[i])){r=r[s[i]];}else if(r===false&&_admin.hasOwnProperty(s[i])){r=_admin[s[i]];}else if(typeof t==='object'&&t.hasOwnProperty(s[i])){t=t[s[i]];}else if(t===false&&data.hasOwnProperty(s[i])){t=data[s[i]];}else if(typeof u==='object'&&u.hasOwnProperty(s[i])){u=u[s[i]];}else if(u===false&&window.hasOwnProperty(s[i])){u=window[s[i]];}}if(r!==_admin&&typeof r!=='object'&&r!==false){return r;}else if(t!==data&&typeof t!=='object'&&t!==false){return t;}else if(u!==window&&typeof u!=='object'&&u!==false){return u;}return m;});};this.externalPage=function(url,title){var id='website-frame';var frame=document.querySelector('iframe#'+id);var fc=document.querySelector('#'+id+'-close');var fh=document.querySelector('#'+id+'-head');if(frame){frame.parentElement.removeChild(frame);}if(fh){fh.parentElement.removeChild(fh);}if(fc){fc.parentElement.removeChild(fc);}if(typeof url!=='string'){return false;}title=typeof title==='string'?title:'Untitled';frame=document.createElement('iframe');frame.id=id;frame.classList.add(id);frame.src=url;frame.onload=function(){_admin.loader(false);};frame.onerror=function(){_admin.loader(false);};document.body.appendChild(frame);_admin.loader(true);fh=document.createElement('div');fh.classList.add(id+'-head');fh.id=id+'-head';fh.dataset.title=title;document.body.appendChild(fh);fc=document.createElement('div');fc.classList.add(id+'-close');fc.id=id+'-close';fc.title='Close';document.body.appendChild(fc);if(!document.body.classList.contains('dont-scroll')){document.body.classList.add('dont-scroll');}var dt=document.querySelector('title');if(dt){var baseTitle=dt.innerText;fc.dataset.title=baseTitle;dt.innerText=title;}window.EXTERNAL_OPEN=true;fc.onclick=function(e){document.body.classList.remove('dont-scroll');this.parentElement.removeChild(this);if(frame){frame.parentElement.removeChild(frame);}if(fh){fh.parentElement.removeChild(fh);}if(dt){dt.innerText=this.dataset.title;}window.EXTERNAL_OPEN=false;return true;};return true;};this.externalPageClose=function(){var id='website-frame';var frame=document.querySelector('iframe#'+id);var fc=document.querySelector('#'+id+'-close');var fh=document.querySelector('#'+id+'-head');var dt=document.querySelector('title');document.body.classList.remove('dont-scroll');window.EXTERNAL_OPEN=false;if(frame){frame.parentElement.removeChild(frame);}if(fh){fh.parentElement.removeChild(fh);}if(fc){if(dt){dt.innerText=fc.dataset.title;}fc.parentElement.removeChild(fc);}return true;};this.fakeHeadLoader=function(cb,value){cb=typeof cb==='function'?cb:function(){};value=value?parseInt(value):0;value=Math.max(Math.min(value,100),0);if(value>=100){_admin.headLoader(false);return cb(true);}_admin.headLoader(value);return setTimeout(function(){value+=3;return _admin.fakeHeadLoader(cb,value);},10);};this.headLoader=function(value){var id='website-head-loader';var hl=document.getElementById(id);var bar=document.getElementById(id+'-bar');if(typeof value!=='number'){if(hl){hl.parentElement.removeChild(hl);}return false;}value=Math.max(Math.min(value,100),0);if(!hl){var hl=document.createElement('div');var bar=document.createElement('div');hl.classList.add('website-head-loader');bar.classList.add('website-head-loader-bar');hl.id=id;bar.id=id+'-bar';}bar.style.width=value+'%';hl.appendChild(bar);document.body.appendChild(hl);};this.loader=function(open,text){var id='website-loader';var ld=document.getElementById(id);if(!open){if(ld){ld.parentElement.removeChild(ld);}return false;}text=typeof text==='string'?text:'Loading...';if(!ld){var ld=document.createElement('div');ld.classList.add(id);ld.id=id;}ld.dataset.text=text;document.body.appendChild(ld);return true;};this.initMenu=function(){var button=document.getElementById('menu-button');var menu=document.getElementById('menu');if(!button||!menu){return false;}if(!this.MENU_WIDTH){this.MENU_WIDTH=620;}button.onclick=this.menuToggle;WINDOW_EVENTS.onresize.push(this.menuOnResize);return this.menuOnResize();};this.menuHide=function(){var menu=document.getElementById('menu');var shade=document.getElementById('menu-shadow');var isOverflow=menu.classList.contains('menu-overflow');if(!shade||!menu||!isOverflow){return false;}document.body.classList.remove('dont-scroll');menu.classList.remove('menu-overflow-show');shade.parentElement.removeChild(shade);menu.style.removeProperty('left');return true;};this.menuShow=function(){var menu=document.getElementById('menu');var isOverflow=menu.classList.contains('menu-overflow');if(!menu||!isOverflow){return false;}menu.classList.add('menu-overflow-show');var shade=document.createElement('div');shade.classList.add('menu-overflow-shadow');shade.id='menu-shadow';shade.onclick=function(e){menu.classList.remove('menu-overflow-show');document.body.classList.remove('dont-scroll');this.parentElement.removeChild(this);};document.body.appendChild(shade);document.body.classList.add('dont-scroll');menu.style.removeProperty('left');return true;};this.menuToggle=function(){var button=document.getElementById('menu-button');var menu=document.getElementById('menu');var shade=document.getElementById('menu-shadow');var isOverflow=menu.classList.contains('menu-overflow');if(!button||!menu||!isOverflow){return false;}if(menu.classList.contains('menu-overflow-show')){document.body.classList.remove('dont-scroll');menu.classList.remove('menu-overflow-show');if(shade){shade.parentElement.removeChild(shade);}return true;}menu.classList.add('menu-overflow-show');var shade=document.createElement('div');shade.classList.add('menu-overflow-shadow');shade.id='menu-shadow';shade.onclick=function(e){menu.classList.remove('menu-overflow-show');document.body.classList.remove('dont-scroll');this.parentElement.removeChild(this);};document.body.appendChild(shade);document.body.classList.add('dont-scroll');return true;};this.menuOnResize=function(){if(!_admin.MENU_WIDTH){return false;}var button=document.getElementById('menu-button');var menu=document.getElementById('menu');var header=document.getElementById('menu-header');var shade=document.getElementById('menu-shadow');var frame=document.getElementById('website-frame');if(!button||!menu||!header){return false;}if(_admin.MENU_WIDTH>=window.innerWidth){button.classList.add('menu-button-show');menu.classList.add('menu-overflow');header.classList.add('menu-header-show');}else{button.classList.remove('menu-button-show');menu.classList.remove('menu-overflow');menu.classList.remove('menu-overflow-show');header.classList.remove('menu-header-show');if(shade){shade.parentElement.removeChild(shade);}if(!frame){document.body.classList.remove('dont-scroll');}}return true;};this.menuMovableLeft=function(id){var el=document.getElementById(id);if(!el){return false;}WINDOW_EVENTS.ontouchend.push(function(e){if(!window.MENU_MOVABLE_LEFT){return false;}if(window.EXTERNAL_OPEN){window.MENU_MOVABLE_LEFT=false;return false;}var isHide=window.MENU_MOVABLE_LEFT.hide;var x=e.changedTouches?e.changedTouches[0].pageX:e.screenX;var left=(x-window.MENU_MOVABLE_LEFT.x)+window.MENU_MOVABLE_LEFT.l;window.MENU_MOVABLE_LEFT=false;if(!isHide){return _admin.menuShow();}else if(left<-100){return _admin.menuHide();}el.style.left='0px';});WINDOW_EVENTS.ontouchmove.push(function(e){if(!window.MENU_MOVABLE_LEFT){return false;}if(window.EXTERNAL_OPEN){window.MENU_MOVABLE_LEFT=false;return false;}var x=e.changedTouches?e.changedTouches[0].pageX:e.screenX;var left=(x-window.MENU_MOVABLE_LEFT.x)+window.MENU_MOVABLE_LEFT.l;if(left>=0&&!window.MENU_MOVABLE_LEFT.hide){window.MENU_MOVABLE_LEFT=false;return _admin.menuShow();}else if(left<-260&&window.MENU_MOVABLE_LEFT.hide){window.MENU_MOVABLE_LEFT=false;return _admin.menuHide();}if(left<0){el.style.left=left+'px';}});WINDOW_EVENTS.ontouchstart.push(function(e){if(window.EXTERNAL_OPEN||_admin.MENU_WIDTH<window.innerWidth){return false;}var x=e.changedTouches?e.changedTouches[0].pageX:e.screenX;var l=el.offsetLeft;if(l===0||x>10){if(el.style.left=='0px'&&x>250){window.MENU_MOVABLE_LEFT={x:x,l:l,el:el,hide:true};}return false;}window.MENU_MOVABLE_LEFT={x:x,l:l,el:el,hide:false};});};this.loginInit=function(){var submit=document.querySelector('input[name="submit"]');var username=document.querySelector('input[name="username"]');var password=document.querySelector('input[name="password"]');if(!submit||!username||!password){return false;}submit.onclick=this.login;username.onkeyup=this.login;password.onkeyup=this.login;return true;};this.login=function(e){var submit=document.querySelector('input[name="submit"]');var username=document.querySelector('input[name="username"]');var password=document.querySelector('input[name="password"]');if(!submit||!username||!password){return false;}if(this===username||this===password){if(e.keyCode!==13){return false;}}if(username.value==''||password.value==''){return false;}_admin.disabled([submit,username,password],true);submit.value='Cheking...';submit.blur();username.blur();password.blur();var data={username:username.value,password:password.value};return _admin.stream(WEBSITE_ADDRESS+'?'+ADMIN_KEY+'=ajax/login',function(r){submit.value='Login';if(typeof r==='string'){_admin.disabled([submit,username,password],false);return _admin.error(r);}_admin.setCookie('webAdmin',r.token,7*365);_admin.setCookie('webAdminData',JSON.stringify(r),7*365);return _admin.success('Login success!',function(){return window.location.reload();});},function(e){_admin.disabled([submit,username,password],false);submit.value='Login';return _admin.error(e);},data);};this.logout=function(){return _admin.confirm('Logout','Are you sure?',function(yes){if(!yes){return false;}_admin.loader(true,'Logging out...');return _admin.request('logout',function(r){_admin.loader(false);if(r!='OK'){return _admin.error(r);}_admin.setCookie('webAdmin','',-7);_admin.setCookie('webAdminData','',-7);return _admin.success('Logout success!',function(){return window.location.assign(WEBSITE_ADDRESS+'?'+ADMIN_KEY);});},function(e){_admin.loader(false);return _admin.error(e);},{token:_admin.USER.token});});};this.logData=function(){var data=false,raw=_admin.getCookie('webAdminData');try{data=JSON.parse(raw);}catch(e){return false;}return data;};this.clearElement=function(el){if(!el.childNodes){return false;}var i=el.childNodes.length;while(i--){el.removeChild(el.childNodes[i]);}return true;};this.parseStr=function(t){if(typeof t!=='string'){return false;}var s=t.split('&');var r={},c={};for(var i=0;i<s.length;i++){if(!s[i]||s[i]==''){continue;}var p=s[i].split('=');var k=decodeURIComponent(p[0]);if(k.match(/\[(.*)?\]$/g)){var l=k.replace(/\[(.*)?\]$/g,'');var w=k.replace(/^.*\[(.*)?\]$/g,"$1");c[l]=c[l]?c[l]:0;if(w==''){w=c[l];c[l]+=1;}if(!r[l]){r[l]={};}r[l][w]=decodeURIComponent(p[1]);continue;}r[k]=p[1]?decodeURIComponent(p[1]):'';}return r;};this.disabled=function(el,pos){if(!Array.isArray(el)){return false;}pos=typeof pos==='boolean'?pos:true;for(var i=0;i<el.length;i++){if(el[i].nodeName==='INPUT'){el[i].disabled=pos;}}return true;};this.getContent=function(url,cb,er,txt){cb=typeof cb==='function'?cb:function(){};er=typeof er==='function'?er:function(){};txt=txt===false?false:true;var xhr=new XMLHttpRequest();xhr.open('GET',url,true);xhr.send();xhr.onreadystatechange=function(e){if(xhr.readyState==4){if(xhr.status==200){var text=xhr.responseText?xhr.responseText:' ';if(txt){return cb(text);}var res=false;try{res=JSON.parse(text);}catch(e){}return cb(res?res:text);}else if(xhr.status==0){return er('Error: No internet connection.');}return er('Error: '+xhr.status+' - '+xhr.statusText+'.');}else if(xhr.readyState<4){return false;}return er('Error: '+xhr.status+' - '+xhr.statusText+'.');};return true;};this.stream=function(url,cb,er,dt,hd,ul,dl,mt,ud4){cb=typeof cb==='function'?cb:function(){};er=typeof er==='function'?er:function(){};ul=typeof ul==='function'?ul:function(){};dl=typeof dl==='function'?dl:function(){};ud4=typeof ud4==='function'?ud4:function(){};var xmlhttp=false;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest();}else{var xhf=[function(){return new ActiveXObject("Msxml2.XMLHTTP");},function(){return new ActiveXObject("Msxml3.XMLHTTP");},function(){return new ActiveXObject("Microsoft.XMLHTTP");}];for(var i=0;i<xhf.length;i++){try{xmlhttp=xhf[i]();}catch(e){continue;}break;}}if(!xmlhttp){return er('Error: Failed to build XML http request.');}var mts=['GET','POST','PUT','OPTIONS','HEAD','DELETE'];mt=typeof mt==='string'&&mts.indexOf(mt)>=0?mt:typeof dt==='object'&&dt!==null?'POST':'GET';xmlhttp.open(mt,url,true);if(typeof dt==='object'&&dt!==null&&!dt.hasOwnProperty('append')&&typeof dt.append!=='function'){xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");dt=this.buildQuery(dt);}if(typeof hd=='object'&&hd!=null){for(var i in hd){xmlhttp.setRequestHeader(i,hd[i]);}}xmlhttp.onreadystatechange=function(e){if(xmlhttp.readyState===4&&xmlhttp.status===200&&typeof xmlhttp.responseText==='string'){try{var res=JSON.parse(xmlhttp.responseText);}catch(e){var res=xmlhttp.responseText;}return cb(res);}else if(xmlhttp.readyState===4){if(xmlhttp.status===0){return er('Error: No internet connection.');}return er('Error: '+xmlhttp.status+' '+xmlhttp.statusText);}else if(xmlhttp.readyState<4){return ud4('Mobile::stream--> '+xmlhttp.readyState+' '+xmlhttp.status+' '+xmlhttp.statusText);}return er('Error: '+xmlhttp.status+' '+xmlhttp.statusText);};xmlhttp.upload.onprogress=ul;xmlhttp.addEventListener("progress",dl,false);xmlhttp.send(dt);};this.buildQuery=function(data,key){var ret=[],dkey=null;for(var d in data){dkey=key?key+'['+encodeURIComponent(d)+']':encodeURIComponent(d);if(typeof data[d]=='object'&&data[d]!==null){ret.push(this.buildQuery(data[d],dkey));}else{ret.push(dkey+"="+encodeURIComponent(data[d]));}}return ret.join("&");};this.uniform=function(dt){var ret=[];for(var d in dt){if(Array.isArray(dt[d])||(typeof dt[d]=='object'&&dt[d]!==null)){ret.push(this.uniform(dt[d]));}else{ret.push(encodeURIComponent(d)+"="+encodeURIComponent(dt[d]));}}return ret.join("&");};this.setCookie=function(cname,cvalue,exdays,domain,path){exdays=exdays?parseInt(exdays):1;var d=new Date();d.setTime(d.getTime()+(exdays*24*60*60*1000));var expires=";expires="+d.toGMTString();var domain=domain?";domain="+domain:'';var path=path?";path="+path:'';document.cookie=cname+"="+cvalue+expires+domain+path;return true;};this.getCookie=function(cname){var name=cname+"=",r=false;var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i].trim();if(c.indexOf(name)==0){r=c.substring(name.length,c.length);break;}}return r;};this.alert=function(title,text,type,callback){title=typeof title==='string'?title:'';text=typeof text==='string'?text:'';type=typeof type==='string'?type:'';return typeof swal==='function'?swal({title:title,text:text,type:type},callback):alert(title+'\r\n\r\n'+text);};this.error=function(text,callback){text=typeof text==='string'?text:text.toString();return typeof swal==='function'?swal({title:"Error",text:text,type:"error"},callback):alert(text);};this.success=function(text,callback){text=typeof text==='string'?text:text.toString();return typeof swal==='function'?swal({title:"Success",text:text,type:"success"},callback):alert(text);};this.confirm=function(title,text,callback){if(typeof title!=='string'||typeof text!=='string'||typeof callback!=='function'){return;}if(typeof swal!=='function'){var c=confirm(title+'\r\n\r\n'+text);return callback(c);}return swal({title:title,text:text,type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",cancelButtonColor:"#DDFFBB",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:true},callback);};return this.init();};
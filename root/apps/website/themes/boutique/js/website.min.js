new website;;function website(){this.version='1.0.0';this.MENU_WIDTH=null;var _website=this;this.onclick=[];this.init=function(){window._website=this;this.initData();this.initPopState();setTimeout(this.initBody,500);WINDOW_EVENTS.onresize.push(this.initBody);this.initMenu();this.initAnchors();WINDOW_EVENTS.execAll();};this.initPopState=function(){WINDOW_EVENTS.onpopstate.push(function(e){if(!window.history.state){var webContent=document.getElementById('website-content');var path=location.pathname.substr(1).replace(/\.html$/,'');if(typeof WEBSITE_DATA==='object'&&WEBSITE_DATA!==null&&WEBSITE_DATA.hasOwnProperty(path)&&webContent){var r=WEBSITE_DATA[path];return _website.putPostData(r);}return false;}return _website.putPostData(window.history.state,true);});};this.initData=function(update){if(!window.hasOwnProperty('WEBSITE_LOAD_PAGES')||!Array.isArray(window.WEBSITE_LOAD_PAGES)){window.WEBSITE_LOAD_PAGES=[];}var hourUpdate=0.1;var rangeUpdate=hourUpdate*3600000;var lastUpdate=localStorage.getItem('website-data-update');var mustUpdate=!lastUpdate||parseInt(lastUpdate)+rangeUpdate<(new Date).getTime()?true:false;var localData=localStorage.getItem('website-data');if(localData&&!update){try{window.WEBSITE_DATA=JSON.parse(localData);}catch(e){localStorage.removeItem('website-data');return this.initData(true);}return mustUpdate?this.initData(true):true;}var url=WEBSITE_ADDRESS+'?website-data=full';return this.getContent(url,function(r){if(typeof r!=='object'||r===null){return console.log(r);}window.WEBSITE_DATA=window.WEBSITE_DATA===null?{}:window.WEBSITE_DATA;for(var i in r){window.WEBSITE_DATA[i]=r[i];}localStorage.setItem('website-data-update',(new Date).getTime());return localStorage.setItem('website-data',JSON.stringify(r));},console.log,false);};this.initAnchors=function(){var an=document.querySelectorAll('a[href]');var i=an.length;while(i--){an[i].onclick=this.execAnchor;}return true;};this.execAnchor=function(e){e.preventDefault();_website.menuHide();if(!window.hasOwnProperty('WEBSITE_ADDRESS')||!this.href){return false;}var query='?website-ajax-request=true';var href=this.getAttribute('href').replace(WEBSITE_ADDRESS,'');if(href.match(/^http/i)){return window.open(href,'_blank');}var webContent=document.getElementById('website-content');if(!webContent){return window.location.assign(href);}if(Array.isArray(_website.onclick)){for(var i=0;i<_website.onclick.length;i++){if(typeof _website.onclick[i]==='function'){_website.onclick[i]();}}}if(href.match(/^article|training$/)){query+='&type='+encodeURIComponent(href);}else if(href.match(/\.html$/)){query+='&slug='+encodeURIComponent(href.replace(/\.html$/,''));}else if(href=='./'||href==''){query+='&home=true';}else if(href.match(/^apps/)){return _website.externalPage(href,this.innerText);}else if(href.match(/^\?admin/)){var gets=href.split('?');var path=gets.hasOwnProperty(1)?'?'+gets[1]:'?admin';return _website.externalPage(WEBSITE_ADDRESS+path,this.innerText);}else{if(this.target=='_blank'){return window.open(href,'_blank');}return window.location.assign(href);}document.scrollingElement.scroll(0,0);webContent.innerText='Loading...';var clone=webContent.cloneNode();if(typeof WEBSITE_DATA==='object'&&WEBSITE_DATA!==null&&WEBSITE_DATA.hasOwnProperty(href.replace(/\.html$/,''))&&WEBSITE_LOAD_PAGES.indexOf(href)<0&&WEBSITE_DATA[href.replace(/\.html$/,'')].aid!=40404){return _website.fakeHeadLoader(function(){var r=WEBSITE_DATA[href.replace(/\.html$/,'')];return _website.putPostData(r);});}_website.loader(true);_website.getContent(WEBSITE_ADDRESS+query,function(r){_website.loader(false);if(typeof r!=='object'){webContent.innerHTML=clone.innerHTML;return alert('Error: Failed to load content.');}WEBSITE_DATA=typeof WEBSITE_DATA==='object'&&WEBSITE_DATA!==null?WEBSITE_DATA:{};if(!WEBSITE_DATA.hasOwnProperty(href.replace(/\.html$/,''))&&(href.match(/\.html$/)||href=='./'||href=='')&&r.type!='bulk'){WEBSITE_DATA[href.replace(/\.html$/,'')]=r;localStorage.setItem('website-data',JSON.stringify(WEBSITE_DATA));}return _website.putPostData(r);},function(r){_website.loader(false);webContent.innerHTML=clone.innerHTML;return alert('Error: Failed to load content.');},false);return false;};this.putPostData=function(post,state){if(typeof post!=='object'||post===null||!post.hasOwnProperty('url')||!post.hasOwnProperty('title')||!post.hasOwnProperty('content')){return false;}_website.externalPageClose();var webContent=document.getElementById('website-content');if(!webContent){return false;}var doc=(new DOMParser).parseFromString(post.content,'text/html');var scr=doc.querySelectorAll('script'),i=scr.length,tempEl=[];/* re-calibrate all elements* ~ NOTE: i'm doing this because*         the scripts are not running while using history.state*         or only put into innerHTML*         and this way is for preventing un-running scripts*/while(i--){var ns=document.createElement('script');ns.async=true;ns.type='text/javascript';if(scr[i].src){ns.src=scr[i].src;}else{ns.textContent=scr[i].textContent;}tempEl.push(ns);scr[i].parentElement.removeChild(scr[i]);}webContent.innerHTML=doc.body.innerHTML;for(var i=tempEl.length;i--;i>=0){webContent.appendChild(tempEl[i]);}var title=document.querySelector('title');if(title){title.innerText=post.title;}if(!state){var surfix=post.type=='bulk'?'':'.html';window.history.pushState(post,post.title,post.url+surfix);}return _website.initAnchors();};this.externalPage=function(url,title){var id='website-frame';var frame=document.querySelector('iframe#'+id);var fc=document.querySelector('#'+id+'-close');var fh=document.querySelector('#'+id+'-head');if(frame){frame.parentElement.removeChild(frame);}if(fh){fh.parentElement.removeChild(fh);}if(fc){fc.parentElement.removeChild(fc);}if(typeof url!=='string'){return false;}title=typeof title==='string'?title:'Untitled';frame=document.createElement('iframe');frame.id=id;frame.classList.add(id);frame.src=url;frame.onload=function(){_website.loader(false);};frame.onerror=function(){_website.loader(false);};document.body.appendChild(frame);_website.loader(true);fh=document.createElement('div');fh.classList.add(id+'-head');fh.id=id+'-head';fh.dataset.title=title;document.body.appendChild(fh);fc=document.createElement('div');fc.classList.add(id+'-close');fc.id=id+'-close';fc.title='Close';document.body.appendChild(fc);if(!document.body.classList.contains('dont-scroll')){document.body.classList.add('dont-scroll');}var dt=document.querySelector('title');if(dt){var baseTitle=dt.innerText;fc.dataset.title=baseTitle;dt.innerText=title;}fc.onclick=function(e){document.body.classList.remove('dont-scroll');this.parentElement.removeChild(this);if(frame){frame.parentElement.removeChild(frame);}if(fh){fh.parentElement.removeChild(fh);}if(dt){dt.innerText=this.dataset.title;}return true;};return true;};this.externalPageClose=function(){var id='website-frame';var frame=document.querySelector('iframe#'+id);var fc=document.querySelector('#'+id+'-close');var fh=document.querySelector('#'+id+'-head');var dt=document.querySelector('title');document.body.classList.remove('dont-scroll');if(frame){frame.parentElement.removeChild(frame);}if(fh){fh.parentElement.removeChild(fh);}if(fc){if(dt){dt.innerText=fc.dataset.title;}fc.parentElement.removeChild(fc);}return true;};this.fakeHeadLoader=function(cb,value){cb=typeof cb==='function'?cb:function(){};value=value?parseInt(value):0;value=Math.max(Math.min(value,100),0);if(value>=100){_website.headLoader(false);return cb(true);}_website.headLoader(value);return setTimeout(function(){value+=3;return _website.fakeHeadLoader(cb,value);},10);};this.headLoader=function(value){var id='website-head-loader';var hl=document.getElementById(id);var bar=document.getElementById(id+'-bar');if(typeof value!=='number'){if(hl){hl.parentElement.removeChild(hl);}return false;}value=Math.max(Math.min(value,100),0);if(!hl){var hl=document.createElement('div');var bar=document.createElement('div');hl.classList.add('website-head-loader');bar.classList.add('website-head-loader-bar');hl.id=id;bar.id=id+'-bar';}bar.style.width=value+'%';hl.appendChild(bar);document.body.appendChild(hl);};this.loader=function(text){var id='website-loader';var ld=document.getElementById(id);if(!text){if(ld){ld.parentElement.removeChild(ld);}return false;}if(!ld){var ld=document.createElement('div');ld.classList.add(id);ld.id=id;}document.body.appendChild(ld);return true;};this.initBody=function(){var webBody=document.getElementById('website-body');var webSidebar=document.getElementById('website-sidebar');if(!webBody||!webSidebar){return false;}var minHeight=webSidebar.offsetHeight;webBody.style.minHeight=minHeight+'px';};this.initMenu=function(){var button=document.getElementById('menu-button');var menu=document.getElementById('menu');if(!button||!menu){return false;}if(!this.MENU_WIDTH){this.MENU_WIDTH=menu.offsetWidth+400;}button.onclick=this.menuToggle;WINDOW_EVENTS.onresize.push(this.menuOnResize);return this.menuOnResize();};this.menuHide=function(){var menu=document.getElementById('menu');var shade=document.getElementById('menu-shadow');var isOverflow=menu.classList.contains('menu-overflow');if(!shade||!menu||!isOverflow){return false;}document.body.classList.remove('dont-scroll');menu.classList.remove('menu-overflow-show');shade.parentElement.removeChild(shade);return true;};this.menuToggle=function(){var button=document.getElementById('menu-button');var menu=document.getElementById('menu');var shade=document.getElementById('menu-shadow');var isOverflow=menu.classList.contains('menu-overflow');if(!button||!menu||!isOverflow){return false;}if(menu.classList.contains('menu-overflow-show')){document.body.classList.remove('dont-scroll');menu.classList.remove('menu-overflow-show');if(shade){shade.parentElement.removeChild(shade);}return true;}menu.classList.add('menu-overflow-show');var shade=document.createElement('div');shade.classList.add('menu-overflow-shadow');shade.id='menu-shadow';shade.onclick=function(e){menu.classList.remove('menu-overflow-show');document.body.classList.remove('dont-scroll');this.parentElement.removeChild(this);};document.body.appendChild(shade);document.body.classList.add('dont-scroll');return true;};this.menuOnResize=function(){if(!_website.MENU_WIDTH){return false;}var button=document.getElementById('menu-button');var menu=document.getElementById('menu');var header=document.getElementById('menu-header');var shade=document.getElementById('menu-shadow');var frame=document.getElementById('website-frame');if(!button||!menu||!header){return false;}if(_website.MENU_WIDTH>window.innerWidth){button.classList.add('menu-button-show');menu.classList.add('menu-overflow');header.classList.add('menu-header-show');}else{button.classList.remove('menu-button-show');menu.classList.remove('menu-overflow');menu.classList.remove('menu-overflow-show');header.classList.remove('menu-header-show');if(shade){shade.parentElement.removeChild(shade);}if(!frame){document.body.classList.remove('dont-scroll');}}return true;};/* get content* @parameters:*   url = string of url*   cb  = function of success callback*   er  = function of error callback*   txt = bool of text output; default: true*/this.getContent=function(url,cb,er,txt){cb=typeof cb==='function'?cb:function(){};er=typeof er==='function'?er:function(){};txt=txt===false?false:true;var xhr=new XMLHttpRequest();xhr.open('GET',url,true);xhr.send();xhr.onreadystatechange=function(e){if(xhr.readyState==4){if(xhr.status==200){var text=xhr.responseText?xhr.responseText:' ';if(txt){return cb(text);}var res=false;try{res=JSON.parse(text);}catch(e){}return cb(res?res:text);}else if(xhr.status==0){return er('Error: No internet connection.');}return er('Error: '+xhr.status+' - '+xhr.statusText+'.');}else if(xhr.readyState<4){return false;}return er('Error: '+xhr.status+' - '+xhr.statusText+'.');};return true;};return this.init();};